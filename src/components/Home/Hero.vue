<script setup lang="ts">
import gsap from 'gsap'
import { ScrollTrigger } from 'gsap/ScrollTrigger'

const isApplyModalOpen = useApplyModalState()

gsap.registerPlugin(ScrollTrigger)
let ctx: gsap.Context
const container = ref<HTMLElement>()
const progress = ref(0)

onMounted(() => {
  if (container.value) {
    ctx = gsap.context(() => {
      ScrollTrigger.create({
        trigger: container.value,
        start: 'top top',
        end: 'bottom top',
        scrub: true,
        onUpdate: (val) => {
          gsap.to(progress, { value: val.progress, ease: 'power4.out', duration: 0.2 })
        }
      })
    }, container.value)
  }
})

onUnmounted(() => {
  ctx?.revert()
})

const { title, description, applyButtonTitle, moreButtonTitle, ecosystemLogosLine } = defineProps<{
  title: string
  description: string
  applyButtonTitle: string
  moreButtonTitle: string
  ecosystemLogosLine: string
}>()
</script>

<template>
  <section class="py-3xl w container" ref="container">
    <h1 class="text-3xl mb-m" data-aos="fade-up">
      {{ title }}
    </h1>
    <p class="text-l dark2 mb-l" data-aos="fade-up" data-aos-delay="100">
      {{ description }}
    </p>
    <div class="flex" data-aos="fade-up" data-aos-delay="200">
      <Button :title="applyButtonTitle" large @click="isApplyModalOpen = !isApplyModalOpen" />
      <Button :title="moreButtonTitle" href="#features" ghost large />
    </div>
    <div class="image" data-aos="fade-up" data-aos-delay="400">
      <picture :style="`--progress: ${progress};`">
        <source srcset="/home/hero.webp" type="image/webp" />
        <img src="/home/hero.png" alt="Hand holding phone with SORA Card in wallet app" />
      </picture>
    </div>
    <div class="chains" data-aos="fade-up" data-aos-delay="300">
      <p class="text-s">
        {{ ecosystemLogosLine }}
      </p>
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 325 70">
        <g clip-path="url(#a)">
          <path fill="#E12" d="M15.7475 61.4c4.1861 2.4 9.1694 3.6 14.3522 3.6 5.1827 0 9.9667-1.4 14.3521-3.6L30.0997 40 15.7475 61.4ZM30.0997 5C13.3555 5 0 18.4 0 35c0 9.8 4.38538 18.2 11.5615 23.8L27.5083 35H11.7608v-5h15.9468v-5H11.7608v-5h36.6777v5H32.4917v5h15.9468v5H32.4917l15.9468 23.8C55.6146 53.2 60 44.8 60 35 60 18.4 46.4452 5 30.0997 5Z"/>
          <path fill="#F0CDC2" d="M101.733 69.6158V52.2466l-21.4867-12.565 21.4867 29.9342Z"/>
          <path fill="#C9B3F5" d="M101.804 69.6158V52.2466l21.486-12.565-21.486 29.9342Z"/>
          <path fill="#88AAF1" d="M101.733 47.9285V25.7607L80 35.4924l21.733 12.4361Z"/>
          <path fill="#C9B3F5" d="M101.804 47.9285V25.7607l21.733 9.7317-21.733 12.4361Z"/>
          <path fill="#F0CDC2" d="M80 35.4924 101.733.384766V25.7607L80 35.4924Z"/>
          <path fill="#B8FAF6" d="M123.537 35.4924 101.804.384766V25.7607l21.733 9.7317Z"/>
          <path stroke="#1616B4" stroke-linejoin="round" stroke-width=".384615" d="M101.733 25.7607v22.1678L80 35.4924m21.733-9.7317L80 35.4924m21.733-9.7317V.384766L80 35.4924m21.804-9.7317v22.1678l21.733-12.4361m-21.733-9.7317 21.733 9.7317m-21.733-9.7317V.384766L123.537 35.4924m-21.804 34.1234V52.2466l-21.4867-12.565 21.4867 29.9342Zm.071 0V52.2466l21.486-12.565-21.486 29.9342Z"/>
          <path fill="#E6007A" d="M172.058 17.5854c5.976 0 10.82-2.8173 10.82-6.2927 0-3.47535-4.844-6.2927-10.82-6.2927-5.975 0-10.819 2.81735-10.819 6.2927 0 3.4754 4.844 6.2927 10.819 6.2927Zm0 47.415c5.976 0 10.82-2.8173 10.82-6.2927s-4.844-6.2927-10.82-6.2927c-5.975 0-10.819 2.8173-10.819 6.2927s4.844 6.2927 10.819 6.2927ZM156.98 26.2957c2.988-5.1749 2.969-10.7796-.043-12.5184-3.012-1.7389-7.875 1.0465-10.863 6.2214-2.988 5.1748-2.968 10.7795.043 12.5184 3.012 1.7388 7.876-1.0466 10.863-6.2214Zm41.058 23.7051c2.988-5.1748 2.97-10.7786-.04-12.5162-3.009-1.7377-7.871 1.0486-10.859 6.2235-2.988 5.1748-2.97 10.7786.04 12.5163 3.009 1.7376 7.871-1.0487 10.859-6.2236Zm-41.1 6.2213c3.012-1.7389 3.032-7.3435.044-12.5184-2.988-5.1748-7.852-7.9602-10.863-6.2214-3.012 1.7389-3.031 7.3436-.044 12.5184 2.988 5.1749 7.852 7.9603 10.863 6.2214Zm41.063-23.7027c3.01-1.7377 3.027-7.3415.04-12.5163-2.988-5.1749-7.85-7.9612-10.86-6.2235-3.009 1.7377-3.027 7.3414-.039 12.5162 2.987 5.1749 7.849 7.9612 10.859 6.2236Z"/>
          <path fill="#0098EA" d="M294.615 65c16.569 0 30-13.4314 30-30s-13.431-30-30-30c-16.568 0-30 13.4314-30 30s13.432 30 30 30Z"/>
          <path fill="#fff" d="M284.371 21.744c-3.767 0-6.155 4.0634-4.259 7.3482l12.644 21.9159c.825 1.431 2.893 1.431 3.718 0l12.646-21.9159c1.893-3.2796-.495-7.3482-4.259-7.3482h-20.49Zm8.374 22.6919-2.753-5.3294-6.645-11.8836c-.438-.7606.103-1.7353 1.021-1.7353h8.375v18.9508l.002-.0025Zm13.132-17.2155-6.642 11.8886-2.754 5.3269V25.4851h8.375c.918 0 1.459.9746 1.021 1.7353Z"/>
          <path fill="#000" d="M226.733 29h-.881c-.052-.2533-.143-.4759-.273-.6676-.128-.1918-.284-.3528-.469-.483-.182-.1325-.385-.232-.607-.2983-.223-.0663-.455-.0994-.696-.0994-.441 0-.839.1113-1.197.3338-.355.2225-.638.5504-.849.9837-.208.4332-.312.9647-.312 1.5944 0 .6298.104 1.1613.312 1.5945.211.4332.494.7611.849.9837.358.2225.756.3338 1.197.3338.241 0 .473-.0332.696-.0995.222-.0663.425-.1645.607-.2947.185-.1326.341-.2948.469-.4865.13-.1941.221-.4167.273-.6676h.881c-.066.3717-.187.7043-.362.9978-.175.2936-.393.5434-.654.7493-.26.2036-.552.3587-.877.4652-.322.1066-.666.1598-1.033.1598-.62 0-1.172-.1515-1.655-.4545-.483-.303-.863-.7339-1.14-1.2926-.277-.5587-.415-1.2216-.415-1.9887 0-.767.138-1.4299.415-1.9886.277-.5587.657-.9896 1.14-1.2926.483-.303 1.035-.4546 1.655-.4546.367 0 .711.0533 1.033.1598.325.1066.617.2628.877.4688.261.2036.479.4522.654.7457.175.2912.296.6238.362.9979Zm7.359 1.3636c0 .7671-.138 1.43-.415 1.9887-.277.5587-.657.9896-1.14 1.2926-.483.303-1.035.4545-1.655.4545-.62 0-1.172-.1515-1.655-.4545-.483-.303-.863-.7339-1.14-1.2926-.277-.5587-.415-1.2216-.415-1.9887 0-.767.138-1.4299.415-1.9886.277-.5587.657-.9896 1.14-1.2926.483-.303 1.035-.4546 1.655-.4546.62 0 1.172.1516 1.655.4546.483.303.863.7339 1.14 1.2926.277.5587.415 1.2216.415 1.9886Zm-.852 0c0-.6297-.105-1.1612-.316-1.5944-.208-.4333-.491-.7612-.849-.9837-.355-.2225-.752-.3338-1.193-.3338-.44 0-.839.1113-1.197.3338-.355.2225-.638.5504-.848.9837-.209.4332-.313.9647-.313 1.5944 0 .6298.104 1.1613.313 1.5945.21.4332.493.7611.848.9837.358.2225.757.3338 1.197.3338.441 0 .838-.1113 1.193-.3338.358-.2226.641-.5505.849-.9837.211-.4332.316-.9647.316-1.5945Zm2.133-3.6363h1.051l2.472 6.0369h.085l2.472-6.0369h1.051V34h-.824v-5.5256h-.071L239.336 34h-.795l-2.273-5.5256h-.071V34h-.824v-7.2727Zm9.577 0V34h-.88v-7.2727h.88Zm7.333 0V34h-.852l-3.963-5.7102h-.071V34h-.881v-7.2727h.853l3.977 5.7244h.071v-5.7244h.866ZM258.817 29c-.078-.2391-.181-.4534-.309-.6428-.125-.1917-.276-.3551-.451-.49-.173-.135-.369-.2379-.589-.309-.22-.071-.462-.1065-.725-.1065-.431 0-.822.1113-1.175.3338-.353.2225-.633.5504-.842.9837-.208.4332-.312.9647-.312 1.5944 0 .6298.105 1.1613.316 1.5945.21.4332.496.7611.856.9837.359.2225.764.3338 1.214.3338.417 0 .784-.0888 1.101-.2664.32-.1799.568-.4332.746-.7599.18-.3291.27-.7162.27-1.1612l.269.0568h-2.187v-.7813h2.77v.7813c0 .5989-.128 1.1198-.384 1.5625-.253.4427-.603.786-1.051 1.0298-.445.2415-.956.3622-1.534.3622-.644 0-1.21-.1515-1.697-.4545-.486-.303-.864-.7339-1.137-1.2926-.27-.5587-.405-1.2216-.405-1.9887 0-.5752.077-1.0925.231-1.5518.157-.4617.377-.8547.661-1.179.284-.3243.62-.5729 1.008-.7457.389-.1728.816-.2593 1.282-.2593.384 0 .741.058 1.073.174.334.1137.631.2759.891.4866.263.2083.482.458.657.7492.175.2889.296.6097.362.9624h-.909Zm-33.959 8.5455c-.043-.3599-.215-.6393-.519-.8381-.303-.1989-.674-.2983-1.115-.2983-.322 0-.603.0521-.845.1562-.239.1042-.426.2474-.561.4297-.132.1823-.199.3895-.199.6215 0 .1941.046.361.139.5007.095.1373.215.2521.362.3444.147.09.301.1646.462.2238.161.0568.309.103.444.1385l.738.1988c.19.0497.4.1184.632.206.235.0876.458.2071.671.3587.216.1491.393.3409.533.5752.14.2344.21.5221.21.863 0 .393-.103.7481-.309 1.0653-.204.3172-.502.5694-.895.7564-.391.187-.865.2805-1.424.2805-.521 0-.972-.084-1.353-.2521-.379-.1681-.677-.4025-.895-.7031-.215-.3007-.337-.6499-.366-1.0476h.909c.024.2746.116.5019.277.6818.164.1776.37.3102.618.3977.251.0853.521.1279.81.1279.336 0 .638-.0545.905-.1634.268-.1112.48-.2651.636-.4616.156-.1989.234-.4309.234-.696 0-.2415-.067-.438-.202-.5895-.135-.1515-.313-.2746-.533-.3693-.22-.0947-.458-.1776-.713-.2486l-.895-.2557c-.569-.1634-1.018-.3965-1.35-.6996-.331-.303-.497-.6996-.497-1.1896 0-.4072.11-.7623.33-1.0653.223-.3054.521-.5422.895-.7103.377-.1704.797-.2557 1.261-.2557.469 0 .885.0841 1.25.2522.364.1657.653.393.866.6818.216.2888.329.6167.341.9837h-.852Zm8.336 1.8181c0 .7671-.138 1.43-.415 1.9887-.277.5587-.657.9896-1.14 1.2926-.483.303-1.035.4545-1.655.4545-.62 0-1.172-.1515-1.655-.4545-.483-.303-.863-.7339-1.14-1.2926-.277-.5587-.415-1.2216-.415-1.9887 0-.767.138-1.4299.415-1.9886.277-.5587.657-.9896 1.14-1.2926.483-.303 1.035-.4546 1.655-.4546.62 0 1.172.1516 1.655.4546.483.303.863.7339 1.14 1.2926.277.5587.415 1.2216.415 1.9886Zm-.852 0c0-.6297-.106-1.1612-.316-1.5944-.209-.4333-.492-.7612-.849-.9837-.355-.2225-.753-.3338-1.193-.3338-.441 0-.839.1113-1.197.3338-.355.2225-.638.5504-.849.9837-.208.4332-.312.9647-.312 1.5944 0 .6298.104 1.1613.312 1.5945.211.4332.494.7611.849.9837.358.2225.756.3338 1.197.3338.44 0 .838-.1113 1.193-.3338.357-.2226.64-.5505.849-.9837.21-.4332.316-.9647.316-1.5945Zm8.269 0c0 .7671-.138 1.43-.415 1.9887-.277.5587-.657.9896-1.14 1.2926-.483.303-1.035.4545-1.655.4545-.62 0-1.172-.1515-1.655-.4545-.483-.303-.863-.7339-1.14-1.2926-.277-.5587-.415-1.2216-.415-1.9887 0-.767.138-1.4299.415-1.9886.277-.5587.657-.9896 1.14-1.2926.483-.303 1.035-.4546 1.655-.4546.62 0 1.172.1516 1.655.4546.483.303.863.7339 1.14 1.2926.277.5587.415 1.2216.415 1.9886Zm-.852 0c0-.6297-.105-1.1612-.316-1.5944-.208-.4333-.491-.7612-.849-.9837-.355-.2225-.753-.3338-1.193-.3338-.44 0-.839.1113-1.197.3338-.355.2225-.638.5504-.848.9837-.209.4332-.313.9647-.313 1.5944 0 .6298.104 1.1613.313 1.5945.21.4332.493.7611.848.9837.358.2225.757.3338 1.197.3338.44 0 .838-.1113 1.193-.3338.358-.2226.641-.5505.849-.9837.211-.4332.316-.9647.316-1.5945Zm7.9-3.6363V43h-.852l-3.963-5.7102h-.071V43h-.881v-7.2727h.852l3.978 5.7244h.071v-5.7244h.866Zm2.059 6.3423c-.175 0-.325-.0627-.451-.1882-.125-.1255-.188-.2758-.188-.451 0-.1752.063-.3255.188-.451.126-.1255.276-.1882.451-.1882.176 0 .326.0627.451.1882.126.1255.189.2758.189.451 0 .116-.03.2225-.089.3196-.057.0971-.134.1752-.231.2344-.095.0568-.201.0852-.32.0852Zm0-3.679c-.175 0-.325-.0627-.451-.1882-.125-.1255-.188-.2758-.188-.451 0-.1752.063-.3255.188-.451.126-.1254.276-.1882.451-.1882.176 0 .326.0628.451.1882.126.1255.189.2758.189.451 0 .116-.03.2226-.089.3196-.057.0971-.134.1752-.231.2344-.095.0568-.201.0852-.32.0852Z"/>
        </g>
        <defs>
          <clipPath id="a">
            <path fill="#fff" d="M0 0h325v70H0z"/>
          </clipPath>
        </defs>
      </svg>
    </div>
  </section>
  <HomeBackground class="bg" :style="`--opacity: ${1 - progress};`" />
</template>

<style scoped>
.image {
  position: relative;
  z-index: -1;
  overflow: hidden;
}

.image picture {
  position: absolute;
}

.chains {
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  flex-direction: column;
}

.chains svg {
  display: block;
  height: 5rem;
}

.bg {
  position: fixed;
  top: 0;
  left: 0;
  z-index: -2;
  display: block;
  opacity: var(--opacity);
}

@media (max-width: 639px) {
  .image {
    margin: var(--space-xl) calc(-1 * var(--space-xs)) calc(-1 * var(--space-l));
  }
}

@media (min-width: 640px) and (max-width: 959px) {
  .image {
    margin: var(--space-xl) calc(-1 * var(--space-s)) calc(-1 * var(--space-l));
  }
}

@media (max-width: 959px) {
  .image {
    aspect-ratio: 25/32;
  }

  .image picture {
    top: 0;
    left: 21%;
    width: 90%;
  }
}

@media (min-width: 960px) {
  .container {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .container>*:not(.image) {
    padding-right: 50%;
  }

  .image {
    position: fixed;
    top: 0;
    right: 0;
    width: 50%;
    height: 100%;
  }

  .image picture,
  .image img {
    top: 11%;
    min-height: 100rem;
    height: 108%;
    max-height: 150%;
    left: 5%;
    width: 110%;
    object-fit: contain;
    object-position: center;
  }

  .image picture {
    transform-origin: bottom right;
    transform: translateY(calc(var(--progress) * -40%)) translateX(calc(var(--progress) * 10%)) rotate(calc(var(--progress) * 20deg));
    opacity: calc(1 - var(--progress));
  }

  .chains {
    flex-direction: row;
    gap: var(--space-m);
    margin-top: var(--space-xl);
  }

  .chains svg {
    display: block;
    height: 7rem;
  }
}
</style>